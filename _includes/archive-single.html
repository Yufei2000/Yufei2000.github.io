{% include base_path %}

{% comment %} 取缩略图：优先 header.teaser，否则 site.teaser {% endcomment %}
{% assign teaser = post.header.teaser | default: site.teaser %}

{% comment %} 绝对 URL（含 ://）原样；否则用 relative_url {% endcomment %}
{% if teaser %}
  {% if teaser contains '://' %}
    {% assign teaser_url = teaser %}
  {% else %}
    {% assign teaser_url = teaser | relative_url %}
  {% endif %}
{% endif %}

{% if post.id %}
  {% assign title = post.title | markdownify | remove: "<p>" | remove: "</p>" %}
{% else %}
  {% assign title = post.title %}
{% endif %}

{%- assign me = site.author_name | default: "Yufei Shi" -%}
{% capture me_bold %}<strong>{{ me }}</strong>{% endcapture %}

<div class="{{ include.type | default: "list" }}__item">
  <article class="archive__item pub-item" itemscope itemtype="http://schema.org/CreativeWork">

    {% if teaser_url %}
      <div class="archive__item-teaser pub-thumb">
        <img src="{{ teaser_url }}" alt="">
      </div>
    {% endif %}

    <div class="archive__item-body pub-body">
      <div class="pub-title"><strong>{{ title }}</strong></div>

      {% if post.authors %}
        <p class="pub-authors">
          {{ post.authors | replace: me, me_bold }}
        </p>
      {% endif %}

      {% if post.venue or post.date %}
        <p class="pub-venue">
          <strong>
            {% if post.venue %}{{ post.venue }}{% endif %}
            {% if post.date %}{% if post.venue %}, {% endif %}{{ post.date | date: "%Y" }}{% endif %}
          </strong>
        </p>
      {% endif %}

      <p class="pub-links">
        {% if post.paper %}
          <a class="pub-link" href="{{ post.paper }}" target="_blank" rel="noopener">[Paper]</a>
        {% endif %}
        {% if post.project %}
          <a class="pub-link" href="{{ post.project }}" target="_blank" rel="noopener">[Project]</a>
        {% endif %}
      </p>
    </div>

  </article>
</div>
